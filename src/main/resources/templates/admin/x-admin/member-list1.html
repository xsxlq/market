<!DOCTYPE html>
<html class="x-admin-sm" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.1</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>
    <link rel="stylesheet" href="../../../static/admin/css/font.css">
    <link rel="stylesheet" href="../../../static/admin/css/xadmin.css">
    <!--<script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>-->
    <script type="text/javascript" src="../../../static/js/comm/jquery_3.3.1.js"></script>
    <script type="text/javascript" src="../../../static/admin/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../static/admin/js/xadmin.js"></script>
    <script type="text/javascript" src="../../../static/admin/js/cookie.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body class="">
<div class="x-nav">
      <span class="layui-breadcrumb">
        <a href="">首页</a>
        <a href="">演示</a>
        <a>
          <cite>导航元素</cite></a>
      </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right"
       href="javascript:location.replace(location.href);" title="刷新">
        <i class="layui-icon" style="line-height:30px">ဂ</i></a>
</div>
<div class="x-body">
    <div class="demoTable">
        搜索 Phone：
        <div class="layui-inline">
            <input class="layui-input" name="id" id="demoReload" autocomplete="off">
        </div>
        <button class="layui-btn" data-type="reload">搜索</button>
    </div>
    <!--<table class="layui-table" lay-data="{url:'./user.json',page:true,toolbar: '#toolbarDemo',id:'test'}"-->
           <!--lay-filter="test">-->
        <!--<thead>-->
        <!--<tr>-->
            <!--<th lay-data="{type:'checkbox'}">ID</th>-->
            <!--<th lay-data="{field:'id', width:80, sort: true}">ID</th>-->
            <!--<th lay-data="{field:'username', width:120, sort: true, edit: 'text'}">用户名</th>-->
            <!--<th lay-data="{field:'email', edit: 'text', minWidth: 150}">邮箱</th>-->
            <!--<th lay-data="{field:'sex', width:80,templet: '#switchTpl'}">性别</th>-->
            <!--<th lay-data="{field:'city', edit: 'text', minWidth: 100}">城市</th>-->
            <!--<th lay-data="{field:'experience', sort: true, edit: 'text'}">积分</th>-->

        <!--</tr>-->
        <!--</thead>-->
    <!--</table>-->
    <!--<table class="layui-table" lay-data="{width: 892, height:332, width:'full',url:'./user.json', page:true, id:'idTest'}" lay-filter="demo">-->
        <!--<thead>-->
        <!--<tr>-->
            <!--<th lay-data="{type:'checkbox', fixed: 'left'}"></th>-->
            <!--<th lay-data="{field:'id', width:80, sort: true, fixed: true}">ID</th>-->
            <!--<th lay-data="{field:'name', width:80}">用户名</th>-->
            <!--<th lay-data="{field:'phone', width:80, sort: true}">手机</th>-->
            <!--<th lay-data="{field:'email', width:158}">邮件</th>-->
            <!--<th lay-data="{field:'registertime', width:225}">注册时间</th>-->

            <!--<th lay-data="{field:'status', width:80}" th:text="${stutus==1?'正常':'冻结'}">状态(0注销/1正常/-1冻结)</th>-->
            <!--<th lay-data="{field:'sayMsg', width:135, sort: true}">留言提醒</th>-->
            <!--<th lay-data="{field:'loveMsg', width:135, sort: true}">收藏提醒</th>-->
            <!--<th lay-data="{field:'perms', width:158, sort: true, fixed: 'right'}">权限</th>-->
            <!--<th lay-data="{fixed: 'right', width:178, align:'center', toolbar: '#barDemo'}"></th>-->
        <!--</tr>-->
        <!--</thead>-->
    <!--</table>-->
    <table id="demo" lay-filter="demo"></table>

    <script type="text/html" id="barDemo">
        <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">编辑</a>
        <a class="layui-btn layui-btn-xs" lay-event="zhengchang">正常</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="dongjie">冻结</a>
    </script>

</div>
<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="getCheckData">获取选中行数据</button>
        <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button>
        <button class="layui-btn layui-btn-sm" lay-event="isAll">验证是否全选</button>
    </div>
</script>
<script type="text/html" id="switchTpl">
    <!-- 这里的 checked 的状态只是演示 -->
    <input type="checkbox" name="sex" value="{{d.id}}" lay-skin="switch" lay-text="女|男" lay-filter="sexDemo" {{ d.id==
           10003 ? 'checked' : '' }}>
</script>
<script>

    layui.use('table', function(){
        var table = layui.table;
        //第一个实例
        table.render({
            elem: '#demo'
            ,height: 312
            ,url: './user.json' //数据接口
            ,page: true //开启分页
            ,id: 'testReload'
            ,cols: [
                [
                {field: 'id', title: 'ID', width:80, sort: true, fixed: 'left'}
                ,{field: 'name', title: '用户名', width:80}
                ,{field: 'phone', title: '电话', width:80, sort: true}
                ,{field: 'email', title: '邮箱', width:80}
                ,{field: 'registertime', title: '注册时间', width: 177}
                ,{field: 'status', title: '状态', width: 80, sort: true
                    ,templet: function(d){
                        if(d.status == -1){
                            return '<span style="color: #c00;">已冻结</span>';
                        }else if(d.status == 0){
                            return '<span style="color: #c00;">已注销</span>';
                        }else{
                            return "正常";
                        }
                    }
                }
                ,{field: 'sayMsg', title: '留言提醒', width: 80, sort: true
                    ,templet: function(d){
                        if(d.sayMsg == 1){
                            return '开启';
                        }else{
                            return "未开启";
                        }
                    }
                }
                ,{field: 'loveMsg', title: '收藏提醒', width: 80
                    ,templet: function(d){
                        if(d.loveMsg == 1){
                            return '开启';
                        }else{
                            return "未开启";
                        }
                    }
                }
                ,{field: 'perms', title: '权限', width: 135, sort: true
                    ,templet: function(d){
                        if(d.perms.indexOf("admin") == -1){
                            return "普通会员";
                        }else{
                            return "管理员";
                        }
                    }
                }
                ,{field: 'right', title: '操作', width: 300,toolbar: '#barDemo'}
                ]
            ]
        });
        // 监听工具条
        table.on('tool(demo)', function(obj){
            var data = obj.data;
            if(obj.event === 'edit'){
                layer.prompt({
                    title:"修改用户权限"
                    ,formType: 0//文本
                    ,value: data.perms
                }, function(value, index){
                    $.post("./updateUser",{id:data.id,perms:value,status:data.status},function(returnMap){
                        if(returnMap.resCode == "1"){
                            obj.update({
                                perms: value
                            });
                            layer.msg('操作成功！');
                            layer.close(index);
                        }else{
                            alert(returnMap.resDesc);
                        }
                    })

                });
            } else if(obj.event === 'dongjie'){
                if(data.status == -1){
                    layer.msg('该用户已冻结！无需操作');
                }else{
                    layer.confirm('冻结此用户', function(index){
                        $.post("./updateUser",{id:data.id,perms:data.perms,status:-1},function(returnMap){
                            if(returnMap.resCode == "1"){
                                obj.update({
                                    status: -1
                                });
                                layer.msg('操作成功！');
                                layer.close(index);
                            }else{
                                alert(returnMap.resDesc);
                            }
                        })

                    });
                }
            } else if(obj.event === 'zhengchang'){
                if(data.status == 1){
                    layer.msg('该用户正常！无需操作');
                }else {
                    layer.confirm('恢复用户状态？', function (index) {
                        $.post("./updateUser", {id: data.id, perms:data.perms,status: 1}, function (returnMap) {
                            if (returnMap.resCode == "1") {
                                obj.update({
                                    status: 1
                                });
                                layer.msg('操作成功！');
                                layer.close(index);
                            } else {
                                alert(returnMap.resDesc);
                            }
                        })

                    });
                }
            }
        });
        var $ = layui.$, active = {
            reload: function () {
                var demoReload = $('#demoReload');

                //执行重载
                table.reload('testReload', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    , where: {
                        phone: demoReload.val()
                    }
                });
            }
        }
        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

    });

    // layui.use('table', function(){
    //     var table = layui.table;
    //     //监听表格复选框选择
    //     table.on('checkbox(demo)', function(obj){
    //         console.log(obj)
    //     });
    //     //监听工具条
    //     table.on('tool(demo)', function(obj){
    //         var data = obj.data;
    //         if(obj.event === 'detail'){
    //             layer.msg('ID：'+ data.id + ' 的查看操作');
    //         } else if(obj.event === 'del'){
    //             layer.confirm('真的删除行么', function(index){
    //                 $.post("./updateUserStatus",{id:data.id,status:-1},function(returnMap){
    //                     if(returnMap.resCode == "1"){
    //                         layer.msg('操作成功！');
    //                         layer.close(index);
    //                     }else{
    //                         alert(returnMap.resDesc);
    //                     }
    //                 })
    //
    //             });
    //         } else if(obj.event === 'edit'){
    //             layer.alert('编辑行：<br>'+ JSON.stringify(data))
    //         }
    //     });
    //
    //     var $ = layui.$, active = {
    //         getCheckData: function(){ //获取选中数据
    //             var checkStatus = table.checkStatus('idTest')
    //                 ,data = checkStatus.data;
    //             layer.alert(JSON.stringify(data));
    //         }
    //         ,getCheckLength: function(){ //获取选中数目
    //             var checkStatus = table.checkStatus('idTest')
    //                 ,data = checkStatus.data;
    //             layer.msg('选中了：'+ data.length + ' 个');
    //         }
    //         ,isAll: function(){ //验证是否全选
    //             var checkStatus = table.checkStatus('idTest');
    //             layer.msg(checkStatus.isAll ? '全选': '未全选')
    //         }
    //     };
    //
    //     $('.demoTable .layui-btn').on('click', function(){
    //         var type = $(this).data('type');
    //         active[type] ? active[type].call(this) : '';
    //     });
    // });

    layui.use('laydate', function () {
        var laydate = layui.laydate;

        //执行一个laydate实例
        laydate.render({
            elem: '#start' //指定元素
        });

        //执行一个laydate实例
        laydate.render({
            elem: '#end' //指定元素
        });


    });
</script>
<script>
    layui.use('table', function () {
        var table = layui.table;

        //监听单元格编辑
        table.on('edit(test)', function (obj) {
            var value = obj.value //得到修改后的值
                , data = obj.data //得到所在行所有键值
                , field = obj.field; //得到字段
            layer.msg('[ID: ' + data.id + '] ' + field + ' 字段更改为：' + value);
        });

        //头工具栏事件
        table.on('toolbar(test)', function (obj) {
            var checkStatus = table.checkStatus(obj.config.id);
            switch (obj.event) {
                case 'getCheckData':
                    var data = checkStatus.data;
                    layer.alert(JSON.stringify(data));
                    break;
                case 'getCheckLength':
                    var data = checkStatus.data;
                    layer.msg('选中了：' + data.length + ' 个');
                    break;
                case 'isAll':
                    layer.msg(checkStatus.isAll ? '全选' : '未全选');
                    break;
            }
            ;
        });
    });
</script>
<script>var _hmt = _hmt || [];
(function () {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?b393d153aeb26b46e9431fabaf0f6190";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();</script>
</body>

</html>